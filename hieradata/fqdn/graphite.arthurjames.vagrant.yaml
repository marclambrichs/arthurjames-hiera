---
arthurjames::notify::message: This is graphite.arthurjames.vagrant

classes:
  - arthurjames::role_node
  - arthurjames::role_graphite

arthurjames::role_graphite::collectd_enabled: true
arthurjames::role_graphite::graphite_enabled: true

arthurjames::profile_relay::relay_type: 'carbon-c-relay'

arthurjames::profile_collectd::plugin_genericjmx: true
arthurjames::profile_collectd::plugin_genericjmx_mbean_params:
  garbage_collector:
    object_name: 'java.lang:type=GarbageCollector,*'
    instance_prefix: 'gc-'
    instance_from: 'name'
    values:
      - type: 'invocations'
        table: false
        attribute: 'CollectionCount'
      - type: 'total_time_in_ms'
        instance_prefix: 'collection_time'
        table: false
        attribute: 'CollectionTime'
arthurjames::profile_collectd::plugin_genericjmx_connection_params:
  java_app:
    host: "%{::fqdn}"
    service_url: 'service:jmx:rmi:///jndi/rmi://localhost:3637/jmxrmi'
    collect:
      - 'memory-heap'
      - 'memory-nonheap'
      - 'garbage_collector'
    
carbon_c_relay::config_clusters:
  i.arthurjames.vagrant:
    replication_factor: 1
    channel: 'carbon_ch'
    hosts:
      - host: 'i.arthurjames.vagrant'
        port: 2203
        alias: 'a'
      - host: 'i.arthurjames.vagrant'
        port: 2303
        alias: 'b'
      - host: 'i.arthurjames.vagrant'
        port: 2403
        alias: 'c'
      - host: 'i.arthurjames.vagrant'
        port: 2503
        alias: 'd'
      - host: 'i.arthurjames.vagrant'
        port: 2603
        alias: 'e'
      - host: 'i.arthurjames.vagrant'
        port: 2703
        alias: 'f'
  d.arthurjames.vagrant:
    replication_factor: 1
    channel: 'carbon_ch'
    hosts:
      - host: 'd.arthurjames.vagrant'
        port: 2203
        alias: 'a'
      - host: 'd.arthurjames.vagrant'
        port: 2303
        alias: 'b'
      - host: 'd.arthurjames.vagrant'
        port: 2403
        alias: 'c'
      - host: 'd.arthurjames.vagrant'
        port: 2503
        alias: 'd'
      - host: 'd.arthurjames.vagrant'
        port: 2603
        alias: 'e'
      - host: 'd.arthurjames.vagrant'
        port: 2703
        alias: 'f'
  local_file:
    forward_proto: 'file'
    file: '/tmp/ccr.log'
carbon_c_relay::config_matches:
  '*':
    cluster_name: 'local_file'
    stop: true
carbon_c_relay::config_rewrites:
  rewrite1:
    comments: |
      ## rewrite carbon c relay internal statistics
      ## from carbon.relays.twiki501.back.test.bc.local.metricsQueued
      ## into bc.test.twiki.twiki501.relay.metricsQueued
    from: '^carbon\.relays\.([a-zA-Z]+)([0-9]+)_([a-zA-Z0-9]+)_([a-zA-Z0-9]+)_([a-zA-Z0-9]+)_([a-zA-Z0-9]+)\.(.*)'
    into: '\5.\4.\1.\1\2.relay.\7'
  rewrite2:
    comments: |
      ## rewrite metrics to reverse hostname
      ## from twiki501.back.test.bc.local.haggar.agent.0.metrics.0
      ## into bc.test.twiki.twiki501.haggar.agent.0.metrics.0
    from: '^([a-zA-Z]+)([0-9]+)\.back\.([a-zA-Z0-9]+)\.([a-zA-Z0-9]+)\.local(.*)'
    into: '\4.\3.\1\.\1\2\5'
  rewrite3:
    comments: |
      ## rewrite metrics from statsite
      ## from sandbox.test.twiki.twiki001.statsite.gauges.gunicorn.workers
      ## from twiki001.back.test.sandbox.local.statsite.gauges.gunicorn.workers
      ## into sandbox.test.twiki.twiki001.statsite.gunicorn.gauges.workers
    from: '^([a-zA-Z0-9]+)\.([a-zA-Z0-9]+)\.([a-zA-Z0-9]+)\.([a-zA-Z]+)([0-9]+)\.statsite\.([a-zA-Z]+)\.([a-zA-Z]+)\.(.*)'
    into: '\1.\2.\3.\4\5.statsite.\7.\6.\8'
  rewrite4:
    comments: |
      ## clean up statsite numstats metric
      ## from sandbox.test.twiki.twiki001.statsite.counts.numStats
      ## into sandbox.test.twiki.twiki001.statsite.numStats
    from: '^([a-zA-Z0-9]+)\.([a-zA-Z0-9]+)\.([a-zA-Z0-9]+)\.([a-zA-Z]+)([0-9]+)\.statsite\.counts\.(.*)'
    into: '\1.\2.\3.\4\5.statsite.\6'
